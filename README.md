# Setup
```
pip install -r requirements.txt
```  
If there is a missing package, please install by yourself using pip.  
also you need setup settings.py for your environment.   

# Usage
Server  
```
python gpu_status_server.py
```  
  
Nodes
```
python gpu_info_sender.py
```  
   
For automatical process, using systemd and crontab will do the works.  
To get GPU information, access `http://<server_address>/states/` , or to specify host `http://<server_address>/states/<host_name>/`  
You can use url parameter to fetch how many log you want by `fetch_num=<# you want>`  

# Browsing
Not yet, sorry XD

# Topology
Topology is very simple, Master (server) and Slave (each local machine) style, but it is ad hoc.
Server is only waiting the slaves to post the gpu information.  
  
# Response
User can get the information of GPU by accessing `http://<server_address>/states/`.  
Json response is like
```
{
    # the order of data is ascending order in time
    "host_name":[
        # host_name log are in array
        {
        	# server recorded timestamp
			"timestamp":20181208153207, # YYYYMMDDhhmmss
            # each GPU will be denote by "gpu:<device_num>"
            "gpu:0":{
                # statues will be associative array (dict)
                "gpu_name": "GeForce GTX 1080 Ti",
                "temperature": "40",
                "timestamp": "2018/11/05 12:24:24.111",
                .
                .
                .
            },
            "gpu:1":{...},
                .
                .
                .
            "gpu:#":{...}
        },
        {
            "gpu:0":{...},
                .
                .
                .
            "gpu:#":{...}
        },
            .
            .
            .
    ],
    "host2_name":[...]
}
```

# Database
## machine table
`mchine` table is a lookup table for hash_code (id) to host name.  
Table field is

| id (TEXT) | name (TEXT)| ip_address (TEXT)|
|-----------|------------|------------|
| hash_code_1 | host_1 | host_1_ip |
| hash_code_2 | host_2 | host_2_ip |
| ... | ... | ... |
| hash_code_n | host_n | host_n_ip |
  
hash_code will be generated by Python code  
```
hash_code = random.getrandbits(128)
```
  
## {host} table
Each host has own table for logging.  
Table field is  

| timestamp (TEXT) | data (BLOB)|
|-----------|------------| 
| timestamp_1 | data_1 |
| timestamp_2 | data_2 |
| ... | ... |
| timestamp_n | data_n |
  
`timestamp` is based on server time zone and the style is "YYYYMMDDhhmmss".  
`data` is a Python dict object while it is serialized and compressed by Python bz2.  
